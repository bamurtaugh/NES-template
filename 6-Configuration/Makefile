# Makefile for 6-Configuration Tests
# Provides convenient commands to test and validate configuration files

.PHONY: test validate clean help install-deps

# Default target
help:
	@echo "Configuration Testing Commands"
	@echo "=============================="
	@echo "make test          - Run all configuration tests"
	@echo "make validate      - Run basic validation script"
	@echo "make python-test   - Run Python test suite only"
	@echo "make install-deps  - Install optional testing dependencies"
	@echo "make clean         - Clean up test artifacts"
	@echo "make help          - Show this help message"

# Run all tests
test: validate python-test
	@echo "âœ… All configuration tests completed"

# Run the validation script
validate:
	@echo "ðŸ”§ Running configuration validation..."
	./validate_configs.sh

# Run only the Python test suite
python-test:
	@echo "ðŸ Running Python test suite..."
	python3 test_configurations.py

# Install optional dependencies for comprehensive testing
install-deps:
	@echo "ðŸ“¦ Installing optional testing dependencies..."
	@pip3 install --user pyyaml toml || echo "Note: Some dependencies may not be available"

# Clean up any test artifacts
clean:
	@echo "ðŸ§¹ Cleaning up test artifacts..."
	@find . -name "*.pyc" -delete 2>/dev/null || true
	@find . -name "__pycache__" -type d -exec rm -rf {} + 2>/dev/null || true
	@echo "Clean complete"

# Quick syntax validation using built-in tools
quick-test:
	@echo "âš¡ Quick syntax validation..."
	@python3 -m json.tool task-config.json > /dev/null && echo "âœ… task-config.json"
	@python3 -m json.tool task-config.schema.json > /dev/null && echo "âœ… task-config.schema.json"
	@test -f pyproject.toml && echo "âœ… pyproject.toml exists"
	@test -f app.yaml && echo "âœ… app.yaml exists"
	@test -f docker-compose.yml && echo "âœ… docker-compose.yml exists"
	@test -f nginx.conf && echo "âœ… nginx.conf exists"
	@test -f apache.conf && echo "âœ… apache.conf exists"